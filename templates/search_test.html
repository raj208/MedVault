<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Doctor Search Tester</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 900px; margin: 24px auto; }
    label { display:block; margin-top: 10px; }
    input, textarea, select { width:100%; padding:8px; }
    button { margin-top: 12px; padding: 8px 14px; }
    .card { border:1px solid #ddd; border-radius:8px; padding:12px; margin:8px 0; }
    code { background:#f6f8fa; padding: 1px 4px; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>Doctor Recommendation — Test Client</h2>
  <p>Posts to <code>/api/search</code>.</p>

  <label>Symptoms</label>
  <textarea id="symptoms" rows="2">chest pain, shortness of breath</textarea>

  <label>History</label>
  <textarea id="history" rows="2">diabetes</textarea>

  <label>City</label>
  <input id="city" value="Mumbai" />

  <label>Pincode</label>
  <input id="pincode" value="400001" />

  <label>Languages (comma-separated ISO codes)</label>
  <input id="languages" value="en, hi" />

  <label>Top K</label>
  <input id="topk" type="number" value="5" min="1" max="50" />

  <button id="go">Search</button>

  <h3>Results</h3>
  <div id="out"></div>

<script>
document.getElementById('go').onclick = async () => {
  const lang = document.getElementById('languages').value.split(',')
                .map(s => s.trim()).filter(Boolean);

  const payload = {
    symptoms: document.getElementById('symptoms').value,
    history: document.getElementById('history').value,
    city: document.getElementById('city').value,
    pincode: document.getElementById('pincode').value,
    languages: lang,
    topk: Number(document.getElementById('topk').value || 5)
  };

  const out = document.getElementById('out');
  out.innerHTML = 'Loading...';

  try {
    const res = await fetch('/api/search', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!res.ok) {
      out.innerHTML = `<div class="card">Error: ${res.status} ${JSON.stringify(data)}</div>`;
      return;
    }
    if (!data.results || data.results.length === 0) {
      out.innerHTML = '<div class="card">No results.</div>';
      return;
    }
    out.innerHTML = data.results.map(r => `
      <div class="card">
        <strong>${r.name || '(no name)'} — ${r.specialties?.join(', ') || ''}</strong><br/>
        <div>Score: ${r.score}</div>
        <div>YOE: ${r.yoe} | Hospital: ${r.hospital || ''}</div>
        <div>Location: ${r.city || ''} ${r.pincode || ''}</div>
        <div>Languages: ${Array.isArray(r.languages) ? r.languages.join(', ') : ''}</div>
        <div>Phone: ${r.phone || ''} | Email: ${r.email || ''}</div>
      </div>
    `).join('');
  } catch (e) {
    out.innerHTML = `<div class="card">Network/JS error: ${String(e)}</div>`;
  }
};
</script>
</body>
</html>
